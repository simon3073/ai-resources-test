<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Learning Resources Hub</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Lucide icons as inline SVG components
    const ChevronUp = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="18 15 12 9 6 15"></polyline>
      </svg>
    );

    const MessageSquare = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    );

    const Plus = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const X = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    // Simple localStorage-based storage API
    window.storage = {
      async get(key, shared) {
        const data = localStorage.getItem(key);
        if (!data) throw new Error('Key not found');
        return { key, value: data, shared };
      },
      async set(key, value, shared) {
        localStorage.setItem(key, value);
        return { key, value, shared };
      },
      async delete(key, shared) {
        localStorage.removeItem(key);
        return { key, deleted: true, shared };
      },
      async list(prefix, shared) {
        const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix || ''));
        return { keys, prefix, shared };
      }
    };

    function AIResourcesHub() {
      const [resources, setResources] = useState([]);
      const [showAddForm, setShowAddForm] = useState(false);
      const [expandedResource, setExpandedResource] = useState(null);
      const [loading, setLoading] = useState(true);
      
      const [newResource, setNewResource] = useState({
        title: '',
        url: '',
        description: ''
      });
      
      const [newComment, setNewComment] = useState('');

      useEffect(() => {
        loadResources();
      }, []);

      const loadResources = async () => {
        try {
          const keys = await window.storage.list('resource:', true);
          if (keys && keys.keys) {
            const loadedResources = [];
            for (const key of keys.keys) {
              try {
                const result = await window.storage.get(key, true);
                if (result && result.value) {
                  loadedResources.push(JSON.parse(result.value));
                }
              } catch (err) {
                console.log('Key not found:', key);
              }
            }
            setResources(loadedResources.sort((a, b) => b.upvotes - a.upvotes));
          }
        } catch (error) {
          console.error('Error loading resources:', error);
        } finally {
          setLoading(false);
        }
      };

      const handleSubmitResource = async () => {
        if (!newResource.title || !newResource.url || !newResource.description) {
          alert('Please fill in all fields');
          return;
        }
        
        const resource = {
          id: Date.now().toString(),
          ...newResource,
          upvotes: 0,
          comments: [],
          createdAt: new Date().toISOString()
        };

        try {
          await window.storage.set(`resource:${resource.id}`, JSON.stringify(resource), true);
          setResources(prev => [resource, ...prev]);
          setNewResource({ title: '', url: '', description: '' });
          setShowAddForm(false);
        } catch (error) {
          console.error('Error saving resource:', error);
          alert('Failed to save resource. Please try again.');
        }
      };

      const handleUpvote = async (resourceId) => {
        const resource = resources.find(r => r.id === resourceId);
        if (!resource) return;

        const updated = { ...resource, upvotes: resource.upvotes + 1 };
        
        try {
          await window.storage.set(`resource:${resourceId}`, JSON.stringify(updated), true);
          setResources(prev => 
            prev.map(r => r.id === resourceId ? updated : r).sort((a, b) => b.upvotes - a.upvotes)
          );
        } catch (error) {
          console.error('Error upvoting:', error);
        }
      };

      const handleAddComment = async (resourceId) => {
        if (!newComment.trim()) return;

        const resource = resources.find(r => r.id === resourceId);
        if (!resource) return;

        const comment = {
          id: Date.now().toString(),
          text: newComment,
          createdAt: new Date().toISOString()
        };

        const updated = {
          ...resource,
          comments: [...resource.comments, comment]
        };

        try {
          await window.storage.set(`resource:${resourceId}`, JSON.stringify(updated), true);
          setResources(prev => prev.map(r => r.id === resourceId ? updated : r));
          setNewComment('');
        } catch (error) {
          console.error('Error adding comment:', error);
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-white flex items-center justify-center">
            <div className="text-gray-600">Loading resources...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-white">
          <div className="max-w-4xl mx-auto px-4 py-8">
            <div className="mb-8">
              <h1 className="text-3xl font-bold text-gray-900 mb-2">AI Learning Resources</h1>
              <p className="text-gray-600">Discover and share the best resources for learning AI</p>
            </div>

            <div className="mb-6">
              {!showAddForm ? (
                <button
                  onClick={() => setShowAddForm(true)}
                  className="flex items-center gap-2 px-4 py-2 bg-black text-white rounded hover:bg-gray-800 transition-colors"
                >
                  <Plus size={20} />
                  Add Resource
                </button>
              ) : (
                <div className="border border-gray-200 rounded-lg p-6 mb-6">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-semibold text-gray-900">Add New Resource</h2>
                    <button onClick={() => setShowAddForm(false)} className="text-gray-500 hover:text-gray-700">
                      <X size={20} />
                    </button>
                  </div>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Title</label>
                      <input
                        type="text"
                        value={newResource.title}
                        onChange={(e) => setNewResource(prev => ({ ...prev, title: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black"
                        placeholder="e.g., Introduction to Neural Networks"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">URL</label>
                      <input
                        type="url"
                        value={newResource.url}
                        onChange={(e) => setNewResource(prev => ({ ...prev, url: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black"
                        placeholder="https://..."
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                      <textarea
                        value={newResource.description}
                        onChange={(e) => setNewResource(prev => ({ ...prev, description: e.target.value }))}
                        className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black"
                        rows="3"
                        placeholder="Brief description of the resource..."
                      />
                    </div>
                    <button
                      onClick={handleSubmitResource}
                      className="px-4 py-2 bg-black text-white rounded hover:bg-gray-800 transition-colors"
                    >
                      Submit Resource
                    </button>
                  </div>
                </div>
              )}
            </div>

            <div className="space-y-4">
              {resources.length === 0 ? (
                <div className="text-center py-12 text-gray-500">
                  No resources yet. Be the first to add one!
                </div>
              ) : (
                resources.map((resource) => (
                  <div key={resource.id} className="border border-gray-200 rounded-lg p-6 hover:border-gray-300 transition-colors">
                    <div className="flex gap-4">
                      <div className="flex flex-col items-center gap-1">
                        <button
                          onClick={() => handleUpvote(resource.id)}
                          className="p-2 hover:bg-gray-100 rounded transition-colors"
                        >
                          <ChevronUp size={24} className="text-gray-700" />
                        </button>
                        <span className="text-sm font-semibold text-gray-900">{resource.upvotes}</span>
                      </div>

                      <div className="flex-1">
                        <h3 className="text-lg font-semibold text-gray-900 mb-1">{resource.title}</h3>
                        <a
                          href={resource.url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-sm text-blue-600 hover:underline mb-2 block"
                        >
                          {resource.url}
                        </a>
                        <p className="text-gray-700 mb-3">{resource.description}</p>

                        <button
                          onClick={() => setExpandedResource(expandedResource === resource.id ? null : resource.id)}
                          className="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900"
                        >
                          <MessageSquare size={16} />
                          {resource.comments.length} {resource.comments.length === 1 ? 'comment' : 'comments'}
                        </button>

                        {expandedResource === resource.id && (
                          <div className="mt-4 pt-4 border-t border-gray-200">
                            <div className="space-y-3 mb-4">
                              {resource.comments.map((comment) => (
                                <div key={comment.id} className="bg-gray-50 rounded p-3">
                                  <p className="text-gray-800">{comment.text}</p>
                                  <p className="text-xs text-gray-500 mt-1">
                                    {new Date(comment.createdAt).toLocaleDateString()}
                                  </p>
                                </div>
                              ))}
                            </div>
                            
                            <div className="flex gap-2">
                              <input
                                type="text"
                                value={newComment}
                                onChange={(e) => setNewComment(e.target.value)}
                                placeholder="Add a comment..."
                                className="flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-black"
                                onKeyPress={(e) => {
                                  if (e.key === 'Enter') {
                                    handleAddComment(resource.id);
                                  }
                                }}
                              />
                              <button
                                onClick={() => handleAddComment(resource.id)}
                                className="px-4 py-2 bg-black text-white rounded hover:bg-gray-800 transition-colors"
                              >
                                Post
                              </button>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                ))
              )}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<AIResourcesHub />, document.getElementById('root'));
  </script>
</body>
</html>
